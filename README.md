# kotlin-grammar-tools

## Description

This library allows tokenize and parse Kotlin code in your program using the Kotlin grammar.

Simple example:
```kotlin
fun main() {
    val tokens = tokenizeKotlinCode("val x = foo() + 10;")
    val parseTree = parseKotlinCode(tokens)
    // or just `val parseTree = parseKotlinCode("val x = foo() + 10;")`

    println(parseTree)
}
```

Tokens or parse tree can be used for various Kotlin code analysis.

Note that the parse tree may not match exactly to PSI (parse tree generated by Kotlin compiler).
This is due to the fact that some errors for the user convenience are not generated at the parser level, but later; the grammar, in turn, takes into account such cases and may not allow the code that could be parsed by the Kotlin compiler parser.

### Kotlin grammar

The grammar is located in the [Kotlin specification repository](https://github.com/JetBrains/kotlin-spec/tree/master/src/grammar).

To update the Kotlin grammar the gradle task `updateGrammar` runs.

To generate the Kotlin parser and lexer the gradle task `generateGrammarSource` runs (using ANTLR gradle plugin).

## Library status

Now the library has experimental status and isn't published in the maven.

## Using

To use the library you can run `publishToMavenLocal` gradle task and add `mavenLocal` repo and dependency from the library.
For example (gradle): `compile("org.jetbrains.kotlin:kotlin-grammar-tools:0.1")`.

## Exceptions

Lexer and parser are throwing exceptions if it has been inputted the invalid code (in terms of lexer or parser): `KotlinLexerException` and `KotlinParserException`.

Example of handling this exceptions:
```kotlin
fun foo(): ParseTree? {
    val tokens = try {
        tokenizeKotlinCode("val x = foo() + 10;")
    } catch (e: KotlinLexerException) {
        println("Tokenization the code fails")
        return null
    }
    val parseTree = try {
        parseKotlinCode(tokens)
    } catch (e: KotlinParserException) {
        println("Parsing the code fails")
        return null
    }

    return parseTree
}
```
